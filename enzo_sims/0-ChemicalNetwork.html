

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Insights from the One-Zone Freefall model &#8212; Dengo Cookbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'enzo_sims/0-ChemicalNetwork';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simulation Setup" href="1-Enzo-Setup.html" />
    <link rel="prev" title="Compare Dengo-Enzo Integration with Enzo-Grackle" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../landing.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/dengo_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/dengo_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../landing.html">
                    Welcom to Dengo Cookbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../install/Install.html">Installation Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Build Your Own Network</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../building_blocks/SimpleNetwork.html">A Chemistry Solver from Scratch</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateSpecies.html">Creating a New Chemical Species</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateReaction.html">Creating Reactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateCoolingFunction.html">Create Cooling Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateANetwork.html">Creating a Network</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Make use of Templates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../templates/solverTemplate.html">How Does Dengo Generate Solvers?</a></li>

<li class="toctree-l1 has-children"><a class="reference internal" href="../templates/dengo_writesolver.html">Making Use of Dengo templates</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../templates/dengo_cython.html">Build Cython Module from Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../templates/dengo_buildClib.html">Build C-library</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic_guides/threebody-check.html">Threebody Reaction Example</a></li>










<li class="toctree-l1"><a class="reference internal" href="../topic_guides/workWithHydroSims.html">Interfacing with Hydro Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic_guides/NonEqilibriumIonization.html">Non-Equilibrium Ionizations in the presence of background ionizations</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Enzo Integration Comparison</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Compare Dengo-Enzo Integration with Enzo-Grackle</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Insights from the One-Zone Freefall model</a></li>
<li class="toctree-l2"><a class="reference internal" href="1-Enzo-Setup.html">Simulation Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-PhasePlot.html">Phase Plot Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-ProfilePlot.html">Radial Profile Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-HeatingCooling.html">Dissecting the Protostellar Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-EvolveOverTff.html">Understand how the heating/cooling changes with time</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api.html">Dengo Documentation</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hisunnytang/dengo-merge" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hisunnytang/dengo-merge/issues/new?title=Issue%20on%20page%20%2Fenzo_sims/0-ChemicalNetwork.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/enzo_sims/0-ChemicalNetwork.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Insights from the One-Zone Freefall model</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#various-heating-cooling-process-at-work">Various Heating/Cooling Process At Work</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rho-t-and-f-h-2-plot">The <span class="math notranslate nohighlight">\(\rho -T \)</span> and <span class="math notranslate nohighlight">\(f_{H_2}\)</span> plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-the-phase-space-of-heating-and-cooling-at-high-density">Identify the Phase Space of Heating and Cooling at High Density</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#net-heating-rate-in-the-grid-space">Net-Heating Rate in the Grid Space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-t-rho-f-h-2-thermal-equilibrium-surface">The <span class="math notranslate nohighlight">\(T-\rho-f_{H_2}\)</span>  thermal equilibrium surface</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-phase-space-of-net-latent-energy">The phase space of net latent energy</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="insights-from-the-one-zone-freefall-model">
<h1>Insights from the One-Zone Freefall model<a class="headerlink" href="#insights-from-the-one-zone-freefall-model" title="Permalink to this heading">#</a></h1>
<p>In this section, we compare the 1-zone freefall model and have a sense of which cooling/heating process are at work at various density.
In particular we are looking into the same reaction network in Grackle that has <code class="docutils literal notranslate"><span class="pre">MultiSpecies</span> <span class="pre">=</span> <span class="pre">2</span></code> setup, the 9 species chemical network.
This particular network includes 21 reactions, and various heating and cooling process.
It aims at describing the chemistry and thermodynamics of metal-free gas.</p>
<p>One-zone freefall model has been adopted to study the thermal and chemical evolution of gravitationally collapsing protostellar clouds. For more details of the model, readers can consult the <a class="reference external" href="https://iopscience.iop.org/article/10.1086/308776/fulltext/40822.text.html">Omukai2000</a> for the details of the model setup and the chemistry involved. This is also one of the test case from <span class="math notranslate nohighlight">\(\texttt{Dengo}\)</span>, where comparison is made against the same 1-zone freefall model from <span class="math notranslate nohighlight">\(\texttt{Grackle}\)</span>. The implementation can be found under the <a class="reference external" href="https://github.com/hisunnytang/dengo-merge/blob/master/examples/test/evolve_free_fall.py"><span class="math notranslate nohighlight">\(\texttt{Dengo}\)</span> Github repo</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">lambdify</span>
<span class="kn">from</span> <span class="nn">dengo.chemical_network</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChemicalNetwork</span><span class="p">,</span>
    <span class="n">reaction_registry</span><span class="p">,</span>
    <span class="n">cooling_registry</span><span class="p">,</span>
    <span class="n">species_registry</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">dengo.primordial_rates</span>
<span class="kn">import</span> <span class="nn">dengo.primordial_cooling</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pickle</span>


<span class="k">def</span> <span class="nf">load_obj</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


<span class="n">dengo</span><span class="o">.</span><span class="n">primordial_rates</span><span class="o">.</span><span class="n">setup_primordial</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">temperature_data</span><span class="p">,</span> <span class="n">evaluate_cooling_terms</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ChiantiPy version 0.12.0 
 found PyQt5 widgets
 using PyQt5 widgets
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kwoksun2/anaconda3/lib/python3.8/site-packages/ChiantiPy-0.12.0-py3.8.egg/ChiantiPy/tools/data.py:71: UserWarning: klgfb files are not present: 
  it will not be possible to use the freeBound continuum method
  warnings.warn(&#39;klgfb files are not present: \n  it will not be possible to use the freeBound continuum method&#39;)
/home/kwoksun2/anaconda3/lib/python3.8/site-packages/ChiantiPy-0.12.0-py3.8.egg/ChiantiPy/core/IpyMspectrum.py:9: UserWarning: ipyparallel not found. You won&#39;t be able to use the ipymspectrum module
  warnings.warn(&quot;ipyparallel not found. You won&#39;t be able to use the ipymspectrum module&quot;)
/home/kwoksun2/anaconda3/lib/python3.8/site-packages/yt/utilities/logger.py:4: VisibleDeprecationWarning: The configuration file /home/kwoksun2/.config/yt/ytrc is deprecated in favor of /home/kwoksun2/.config/yt/yt.toml. Currently, both are present. Please manually remove the deprecated one to silence this warning.
Deprecated since v4.0.0. This feature will be removed in v4.1.0
  from yt.config import ytcfg
</pre></div>
</div>
</div>
</div>
<section id="various-heating-cooling-process-at-work">
<h2>Various Heating/Cooling Process At Work<a class="headerlink" href="#various-heating-cooling-process-at-work" title="Permalink to this heading">#</a></h2>
<p>In the below, we visualize how various thermal process dominates in different density ranges.
<code class="docutils literal notranslate"><span class="pre">compressional</span></code> heating is the approximate energy input from the gravitational work acting on the gas parcel.
<code class="docutils literal notranslate"><span class="pre">Gloverabel08</span></code> refers to the H2 continuum cooling, it is the dominant cooling process at density below <span class="math notranslate nohighlight">\(\rho \sim 10^{-12}\mathrm{g ~ cm^{3}}\)</span>. In low density regimes, compressional heating wins over the continnum cooling, resulting ina slow climb in temperature as density increases.
<code class="docutils literal notranslate"><span class="pre">h2formation</span></code> refers to the net binding energy release/ absorbed from the formation/dissociation of molecular hydrogen. At density of <span class="math notranslate nohighlight">\(\gt 10^{-16} \mathrm{g ~ cm^{3}} \)</span>, the three-body reaction is ruling formation pathways for molecular hydrogen, binding energy contributes a significant part to the overall thermal process. As the molecular hydrogen are built up slowly, the dissociation of <span class="math notranslate nohighlight">\(H_2\)</span> molecules begins to come into play and begin to cool down the gas as the <span class="math notranslate nohighlight">\(H_2\)</span> breaks into Hydrogen atoms.
Collision-Induced emission is also expected to be significant at higher density of around  <span class="math notranslate nohighlight">\(10^{-8} \mathrm{g ~ cm^{3}}  \)</span>  onwards.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">calculate_instant_cooling_rates</span>

<span class="n">init_values</span> <span class="o">=</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">&quot;/home/kwoksun2/data/dengo-merge/cvode_klu/freefall_dengo&quot;</span><span class="p">)</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="mf">1.67e-24</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">20</span>


<span class="n">density</span> <span class="o">=</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">all_rates</span> <span class="o">=</span> <span class="n">calculate_instant_cooling_rates</span><span class="p">(</span><span class="n">init_values</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">tidx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;compressional&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">]</span>
    <span class="o">*</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">6.67384e-8</span> <span class="o">*</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="o">*</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span>
    <span class="o">-</span><span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;gloverabel08&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gloverabel08&quot;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span>
    <span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;h2formation&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;h2formation&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span>
    <span class="o">-</span><span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;h2formation&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span>
    <span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;compressional&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;compressional&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span>
    <span class="o">-</span><span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;cie_cooling&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cie_cooling&quot;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;density ($\mathrm{g ~ cm^{-3}})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac{d\epsilon}</span><span class="si">{dt}</span><span class="s2"> \times t_</span><span class="si">{ff}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$\\frac{d\\epsilon}{dt} \\times t_{ff}$&#39;)
</pre></div>
</div>
<img alt="../_images/601c65d50ee1ebb0dbeff422bb5822c837f932e76132bab5cc2f7994711edbd5.png" src="../_images/601c65d50ee1ebb0dbeff422bb5822c837f932e76132bab5cc2f7994711edbd5.png" />
</div>
</div>
</section>
<section id="the-rho-t-and-f-h-2-plot">
<h2>The <span class="math notranslate nohighlight">\(\rho -T \)</span> and <span class="math notranslate nohighlight">\(f_{H_2}\)</span> plot<a class="headerlink" href="#the-rho-t-and-f-h-2-plot" title="Permalink to this heading">#</a></h2>
<p>The plot below demonstrates temperature evolution and the molecular hydrogen fraction as a function of density.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Temperature(K)&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;density ($\mathrm{g ~ cm^{-3}})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">],</span>
    <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H2_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.67e-24</span> <span class="o">*</span> <span class="mf">2.01588</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;H2I Fraction&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f_{\mathrm</span><span class="si">{H_2}</span><span class="s2">}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$f_{\\mathrm{H_2}}$&#39;)
</pre></div>
</div>
<img alt="../_images/48b1799026f822492d0fcfc80bb07d9d467b7dc550930d1e30108d8f860091ae.png" src="../_images/48b1799026f822492d0fcfc80bb07d9d467b7dc550930d1e30108d8f860091ae.png" />
</div>
</div>
</section>
<section id="identify-the-phase-space-of-heating-and-cooling-at-high-density">
<h2>Identify the Phase Space of Heating and Cooling at High Density<a class="headerlink" href="#identify-the-phase-space-of-heating-and-cooling-at-high-density" title="Permalink to this heading">#</a></h2>
<p>While in the above, we demonstrate that how various chemical process plays a role for a free-falling parcel. This is however is not fully representative of the full phase space of which one would encounter in a full-blown hydrodynamical chemical kinetics simulations. In the below, we are particularly interested in learning the phase space at which the chemical network can achieve a thermal equilibrium.</p>
<p>We initialize a 3d grid of initial conditions with logarithmically spaced density,temperature, and <span class="math notranslate nohighlight">\(H_2\)</span> fraction. And we evaluate the cooling rates over this fiducial 3d grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dengo.chemistry_constants</span> <span class="kn">import</span> <span class="n">kboltz</span><span class="p">,</span> <span class="n">mh</span>


<span class="n">ncells</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)</span>
<span class="n">_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)</span>
<span class="n">_fH2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)</span>

<span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">fH2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_rho</span><span class="p">,</span> <span class="n">_T</span><span class="p">,</span> <span class="n">_fH2</span><span class="p">)</span>

<span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">fH2</span> <span class="o">=</span> <span class="n">fH2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">H2_1</span> <span class="o">=</span> <span class="mf">0.76</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">fH2</span>
<span class="n">H_1</span> <span class="o">=</span> <span class="mf">0.76</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">-</span> <span class="n">H2_1</span>
<span class="n">He_1</span> <span class="o">=</span> <span class="mf">0.24</span> <span class="o">*</span> <span class="n">rho</span>


<span class="n">init_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H2_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H2_1</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_1</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;He_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">He_1</span> <span class="o">/</span> <span class="n">mh</span>

<span class="n">tiny</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;He_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">tiny</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;He_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">tiny</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">tiny</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H2_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">tiny</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H_m0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">tiny</span> <span class="o">/</span> <span class="n">mh</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;de&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">tiny</span> <span class="o">/</span> <span class="n">mh</span>


<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H2_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;He_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">*</span> <span class="n">kboltz</span>
    <span class="o">*</span> <span class="n">T</span>
    <span class="o">/</span> <span class="n">rho</span>
<span class="p">)</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>


<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;mdensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span>
<span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">20</span>


<span class="n">all_rates</span> <span class="o">=</span> <span class="n">calculate_instant_cooling_rates</span><span class="p">(</span>
    <span class="n">init_values</span><span class="p">,</span>
    <span class="n">rho</span> <span class="o">/</span> <span class="n">mh</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">rates3d</span> <span class="o">=</span> <span class="n">all_rates</span><span class="p">[</span><span class="s2">&quot;chemical&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="net-heating-rate-in-the-grid-space">
<h2>Net-Heating Rate in the Grid Space<a class="headerlink" href="#net-heating-rate-in-the-grid-space" title="Permalink to this heading">#</a></h2>
<p>Blue/Red regions are where chemical cooling/heating is dominant. Different panels corresponds to different <span class="math notranslate nohighlight">\(H_2\)</span> fraction. When the molecular hydrogen fraction is low, heating is significant at low temperature, and a sharp transition is observed as the temperature increased. That can be explained by the increased dissociation rates at those phase space, where significant cooling is expected from the conversion of thermal energy into the binding energy. As the H2 fraction increases, h2 formation heating becomes less and less significant. Finally, when the cloud reaches close to fully molecular, the cloud would undergo chemical cooling in almost all of the phase space explored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">SymLogNorm</span><span class="p">,</span> <span class="n">LogNorm</span>

<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">ge3d</span> <span class="o">=</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">]</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">rates3d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">SymLogNorm</span><span class="p">(</span><span class="n">linthresh</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;density $\mathrm{g ~ cm^{-3}}$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)$&quot;</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/957bfe66ef3312788b0c6e24f818c7a9406e69bccbc90e26fe06f0703fb3b81f.png" src="../_images/957bfe66ef3312788b0c6e24f818c7a9406e69bccbc90e26fe06f0703fb3b81f.png" />
</div>
</div>
</section>
<section id="the-t-rho-f-h-2-thermal-equilibrium-surface">
<h2>The <span class="math notranslate nohighlight">\(T-\rho-f_{H_2}\)</span>  thermal equilibrium surface<a class="headerlink" href="#the-t-rho-f-h-2-thermal-equilibrium-surface" title="Permalink to this heading">#</a></h2>
<p>The region in phase space where chemical heating balances out the chemical cooling is where thermal equilibrium is achieved. If the gas parcel is too hot, chemical cooling would begin to cool the gas parcel, and vice versa. It is therefore a self-regulating mechanism where the thermal equilibrium can be achieved. In the below, we identified the region where this transition happens, and plot the equilibrium temperature required for such equilibrium to take place at different density and moelcular hydrogen fraction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">signs3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rates3d</span><span class="p">)</span>
<span class="n">tequil</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_ifh2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncells</span><span class="p">):</span>
    <span class="n">tnow</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncells</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">_T</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">signs3d</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">_ifh2</span><span class="p">],</span> <span class="n">prepend</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tnow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tnow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="n">tequil</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tnow</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">_rho</span><span class="p">,</span> <span class="n">tequil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">_rho</span><span class="p">,</span> <span class="n">tequil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">_rho</span><span class="p">,</span> <span class="n">tequil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">_rho</span><span class="p">,</span> <span class="n">tequil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;density ($\mathrm</span><span class="si">{g}</span><span class="s2"> ~ \mathrm</span><span class="si">{cm}</span><span class="s2">^{-3}$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;temperature ($\mathrm</span><span class="si">{K}</span><span class="s2">$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
100
200
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;temperature ($\\mathrm{K}$)&#39;)
</pre></div>
</div>
<img alt="../_images/8f5288f95828f0545bd502cd3c24e13eef20cd63b17a5a787cf77cf12eb12727.png" src="../_images/8f5288f95828f0545bd502cd3c24e13eef20cd63b17a5a787cf77cf12eb12727.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="n">_rho</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncells</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="n">_fH2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncells</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tequil</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log$ T&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log f_</span><span class="si">{H_2}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log \rho$ &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;$\\log \\rho$ &#39;)
</pre></div>
</div>
<img alt="../_images/fffa44260843e109e2f192bbd31ca68906df9cc122607e8214d683b47f6edd7d.png" src="../_images/fffa44260843e109e2f192bbd31ca68906df9cc122607e8214d683b47f6edd7d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">_rho</span><span class="p">,</span> <span class="n">_fH2</span><span class="p">,</span> <span class="n">tequil</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\rho$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$f_</span><span class="si">{H_2}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Equilibrium Temperature&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4a906521ce94b2bea08259a066b33136b960410fe70920b0fbfe3cbedae2663a.png" src="../_images/4a906521ce94b2bea08259a066b33136b960410fe70920b0fbfe3cbedae2663a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">SymLogNorm</span><span class="p">,</span> <span class="n">LogNorm</span>

<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ge3d</span> <span class="o">=</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="p">(</span><span class="n">ge3d</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">rates3d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">SymLogNorm</span><span class="p">(</span><span class="n">linthresh</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1">#     ax.loglog(_rho, tequil[idx], color=&#39;w&#39;)</span>
<span class="c1"># plt.colorbar(im, cax = ax)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_16537/3796042406.py:14: UserWarning: The input coordinates to pcolormesh are interpreted as cell centers, but are not monotonically increasing or decreasing. This may lead to incorrectly calculated cell edges, in which case, please supply explicit cell edges to pcolormesh.
  im = ax.pcolormesh(
</pre></div>
</div>
<img alt="../_images/f3f795954085e703e50ac189cec35770aa2172c0d531549a4899b7fc1db01a97.png" src="../_images/f3f795954085e703e50ac189cec35770aa2172c0d531549a4899b7fc1db01a97.png" />
</div>
</div>
</section>
<section id="the-phase-space-of-net-latent-energy">
<h2>The phase space of net latent energy<a class="headerlink" href="#the-phase-space-of-net-latent-energy" title="Permalink to this heading">#</a></h2>
<p>There is significant latent energy tapped from atomic hydrogen. They are released as molecular hydrogen is formed. In the below we adjust the y-axis to be the specific thermal energy plus the latent energy from the cloud.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ge</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H2_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;He_1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">*</span> <span class="n">kboltz</span>
    <span class="o">*</span> <span class="n">T</span>
    <span class="o">/</span> <span class="n">rho</span>
<span class="p">)</span>
<span class="n">h_latent</span> <span class="o">=</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;H_1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">7.176e-12</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">rho</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ge3d</span> <span class="o">=</span> <span class="n">init_values</span><span class="p">[</span><span class="s2">&quot;ge&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fH2 = </span><span class="si">{</span><span class="n">_fH2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="p">(</span><span class="n">h_latent</span> <span class="o">+</span> <span class="n">ge</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">ncells</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">rates3d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">idx</span><span class="p">],</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">SymLogNorm</span><span class="p">(</span><span class="n">linthresh</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1">#     ax.loglog(_rho, tequil[idx], color=&#39;w&#39;)</span>
<span class="c1"># plt.colorbar(im, cax = ax)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_16537/2780049909.py:13: UserWarning: The input coordinates to pcolormesh are interpreted as cell centers, but are not monotonically increasing or decreasing. This may lead to incorrectly calculated cell edges, in which case, please supply explicit cell edges to pcolormesh.
  im = ax.pcolormesh(
</pre></div>
</div>
<img alt="../_images/4e299d5d99c8873b8384ef64c3d59d7fbd2ee8c4a99a258d0a9746c9d42e18a0.png" src="../_images/4e299d5d99c8873b8384ef64c3d59d7fbd2ee8c4a99a258d0a9746c9d42e18a0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">signs3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rates3d</span><span class="p">)</span>

<span class="n">tidx</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_ifh2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncells</span><span class="p">):</span>
    <span class="n">tnow</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncells</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">signs3d</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">_ifh2</span><span class="p">],</span> <span class="n">prepend</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tnow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tnow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">tidx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tnow</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="n">_rho</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncells</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="n">_fH2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncells</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">h_latent</span> <span class="o">+</span> <span class="n">ge</span><span class="p">)[</span><span class="n">tidx</span><span class="p">]),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log$ T&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log f_</span><span class="si">{H_2}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\log \rho$ &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;$\\log \\rho$ &#39;)
</pre></div>
</div>
<img alt="../_images/61d3625f68e830f62b41b6a5e27db951498545116312a285307fbfa712e47c40.png" src="../_images/61d3625f68e830f62b41b6a5e27db951498545116312a285307fbfa712e47c40.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span>
    <span class="n">_rho</span><span class="p">,</span>
    <span class="n">_fH2</span><span class="p">,</span>
    <span class="p">(</span><span class="n">h_latent</span> <span class="o">+</span> <span class="n">ge</span><span class="p">)[</span><span class="n">tidx</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;plasma&quot;</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">()</span>
    <span class="c1">#     linewidth=0,</span>
    <span class="c1">#     antialiased=False</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\rho$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$f_</span><span class="si">{H_2}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Specific Thermal Energy + Latent Energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/33db4579c64df0f9f0c01d34b4ac9e4c764dfcfcf8a4b547bf952329f1e9f2ab.png" src="../_images/33db4579c64df0f9f0c01d34b4ac9e4c764dfcfcf8a4b547bf952329f1e9f2ab.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./enzo_sims"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Compare Dengo-Enzo Integration with Enzo-Grackle</p>
      </div>
    </a>
    <a class="right-next"
       href="1-Enzo-Setup.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Simulation Setup</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#various-heating-cooling-process-at-work">Various Heating/Cooling Process At Work</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rho-t-and-f-h-2-plot">The <span class="math notranslate nohighlight">\(\rho -T \)</span> and <span class="math notranslate nohighlight">\(f_{H_2}\)</span> plot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#identify-the-phase-space-of-heating-and-cooling-at-high-density">Identify the Phase Space of Heating and Cooling at High Density</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#net-heating-rate-in-the-grid-space">Net-Heating Rate in the Grid Space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-t-rho-f-h-2-thermal-equilibrium-surface">The <span class="math notranslate nohighlight">\(T-\rho-f_{H_2}\)</span>  thermal equilibrium surface</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-phase-space-of-net-latent-energy">The phase space of net latent energy</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sunny Tang
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>