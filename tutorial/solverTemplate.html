

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>How Does Dengo Generate Solvers? &#8212; Dengo Cookbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/solverTemplate';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../landing.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/dengo_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/dengo_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../landing.html">
                    Welcom to Dengo Cookbook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../install/Install.html">Installation Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Build Your Own Network</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../building_blocks/SimpleNetwork.html">A Chemistry Solver from Scratch</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateSpecies.html">Creating a New Chemical Species</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateReaction.html">Creating Reactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateCoolingFunction.html">Create Cooling Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building_blocks/CreateANetwork.html">Creating a Network</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Make use of Templates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../templates/solverTemplate.html">How Does Dengo Generate Solvers?</a></li>

<li class="toctree-l1 has-children"><a class="reference internal" href="../templates/dengo_writesolver.html">Making Use of Dengo templates</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../templates/dengo_cython.html">Build Cython Module from Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../templates/dengo_buildClib.html">Build C-library</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic_guides/threebody-check.html">Threebody Reaction Example</a></li>










<li class="toctree-l1"><a class="reference internal" href="../topic_guides/workWithHydroSims.html">Interfacing with Hydro Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic_guides/NonEqilibriumIonization.html">Non-Equilibrium Ionizations in the presence of background ionizations</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Enzo Integration Comparison</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../enzo_sims/intro.html">Compare Dengo-Enzo Integration with Enzo-Grackle</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../enzo_sims/0-ChemicalNetwork.html">Insights from the One-Zone Freefall model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enzo_sims/1-Enzo-Setup.html">Simulation Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enzo_sims/2-PhasePlot.html">Phase Plot Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enzo_sims/3-ProfilePlot.html">Radial Profile Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enzo_sims/4-HeatingCooling.html">Dissecting the Protostellar Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enzo_sims/5-EvolveOverTff.html">Understand how the heating/cooling changes with time</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api.html">Dengo Documentation</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hisunnytang/dengo-merge" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hisunnytang/dengo-merge/issues/new?title=Issue%20on%20page%20%2Ftutorial/solverTemplate.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorial/solverTemplate.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How Does Dengo Generate Solvers?</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How Does Dengo Generate Solvers?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries-and-create-the-network">Import Libraries and Create the Network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-solver">Building the solver</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-the-reaction-rates">Evaluate the reaction rates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-jinja2">Using <code class="docutils literal notranslate"><span class="pre">Jinja2</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-rates-interpolation-template">Preparing the rates interpolation template</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-the-rendered-simple-reaction-rate-py-and-check-if-it-works">Import the Rendered <code class="docutils literal notranslate"><span class="pre">simple_reaction_rate.py</span></code> and Check if it works!</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-temperature-function">Implement the temperature function</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-rhs-function">Implement the RHS function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#yay-you-have-learnt-how-to-write-a-jinja2-template-from-scratch">Yay! you have learnt how to write a Jinja2 template from scratch</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-does-dengo-generate-solvers">
<h1>How Does Dengo Generate Solvers?<a class="headerlink" href="#how-does-dengo-generate-solvers" title="Permalink to this heading">#</a></h1>
<p>This tutorial tells you how the solver are generated with the help of <code class="docutils literal notranslate"><span class="pre">dengo.ChemicalNetwork</span></code>, and <code class="docutils literal notranslate"><span class="pre">Jinja2</span></code>. In short, <code class="docutils literal notranslate"><span class="pre">dengo.ChemicalNetwork</span></code> carries the full information of the chemical reactions and cooling actions of interest. It internally generates the symbolic representation of the dynamics of each chemical species. This can be exported as <code class="docutils literal notranslate"><span class="pre">C++</span></code> or <code class="docutils literal notranslate"><span class="pre">python</span></code> code with a pre-written templates which can be found under <code class="docutils literal notranslate"><span class="pre">dengo/templates</span></code>. In this example we will be demonstrating how to generate rhs and solve the initial value problem with<code class="docutils literal notranslate"><span class="pre">scipy.odeint</span></code></p>
<section id="import-libraries-and-create-the-network">
<h2>Import Libraries and Create the Network<a class="headerlink" href="#import-libraries-and-create-the-network" title="Permalink to this heading">#</a></h2>
<p>Primordial rates and cooling for the 9-species network are included in the default dengo library in <code class="docutils literal notranslate"><span class="pre">dengo.primordial_rates</span></code> and <code class="docutils literal notranslate"><span class="pre">dengo.primordial_cooling</span></code>. The reactions and cooling are added automatically to the <code class="docutils literal notranslate"><span class="pre">reaction_registry</span></code>, <code class="docutils literal notranslate"><span class="pre">cooling_registry</span></code> and <code class="docutils literal notranslate"><span class="pre">species_registry</span></code> with the call to <code class="docutils literal notranslate"><span class="pre">dengo.primordial_rates.setup_primordial</span></code>.</p>
<p>Here we setup the same sample network we demonstrated in the last chapter with <code class="docutils literal notranslate"><span class="pre">k01</span></code>, <code class="docutils literal notranslate"><span class="pre">k02</span></code> and <code class="docutils literal notranslate"><span class="pre">reHII</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dengo</span>
<span class="kn">from</span> <span class="nn">dengo.chemical_network</span> <span class="kn">import</span> \
 <span class="n">ChemicalNetwork</span><span class="p">,</span> \
 <span class="n">reaction_registry</span><span class="p">,</span> \
 <span class="n">cooling_registry</span><span class="p">,</span> <span class="n">species_registry</span>
<span class="kn">import</span> <span class="nn">dengo.primordial_rates</span>
<span class="kn">import</span> <span class="nn">dengo.primordial_cooling</span>

<span class="n">dengo</span><span class="o">.</span><span class="n">primordial_rates</span><span class="o">.</span><span class="n">setup_primordial</span><span class="p">()</span>

<span class="n">simpleNetwork</span> <span class="o">=</span> <span class="n">ChemicalNetwork</span><span class="p">()</span>
<span class="n">simpleNetwork</span><span class="o">.</span><span class="n">add_reaction</span><span class="p">(</span><span class="s2">&quot;k01&quot;</span><span class="p">)</span>
<span class="n">simpleNetwork</span><span class="o">.</span><span class="n">add_reaction</span><span class="p">(</span><span class="s2">&quot;k02&quot;</span><span class="p">)</span>
<span class="n">simpleNetwork</span><span class="o">.</span><span class="n">add_cooling</span><span class="p">(</span><span class="s2">&quot;reHII&quot;</span><span class="p">)</span>
<span class="n">simpleNetwork</span><span class="o">.</span><span class="n">init_temperature</span><span class="p">((</span><span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adding reaction: k01 : 1*H_1 + 1*de =&gt; 1*H_2 + 2*de
Adding reaction: k02 : 1*H_2 + 1*de =&gt; 1*H_1
</pre></div>
</div>
</div>
</div>
</section>
<section id="building-the-solver">
<h2>Building the solver<a class="headerlink" href="#building-the-solver" title="Permalink to this heading">#</a></h2>
<p>In this example, we will walk you through how to write a template from scratch that can be fed into a scipy solver. This can be done with <code class="docutils literal notranslate"><span class="pre">ChemicalNetwork.write_solver</span></code> and the combination of templates available under <code class="docutils literal notranslate"><span class="pre">dengo/templates</span></code>.</p>
<section id="evaluate-the-reaction-rates">
<h3>Evaluate the reaction rates<a class="headerlink" href="#evaluate-the-reaction-rates" title="Permalink to this heading">#</a></h3>
<p>Reaction rates usually have a temperature dependence. For example, for reactions following the <a class="reference external" href="https://en.wikipedia.org/wiki/Arrhenius_equation">Arrhenius equation</a> usually have the forms of <span class="math notranslate nohighlight">\(k(T) = A e^{-\frac{E_a}{RT}}\)</span>, where <span class="math notranslate nohighlight">\(k\)</span> is the reaction rate, <span class="math notranslate nohighlight">\(E_a\)</span> is the activation energy of the reaction, <span class="math notranslate nohighlight">\(T\)</span> is the temperature, <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(R\)</span> are the pre-exponential factor, and the universal gas constant respectively. <span class="math notranslate nohighlight">\(A\)</span> is sometimes depends further on temperature in <a class="reference external" href="https://en.wikipedia.org/wiki/Arrhenius_equation#Modified_Arrhenius_equation">Modified Arrhenius equation</a>.</p>
<p>Evaluating these rates on the fly would be computationally expensive. One possible way of reducing the computational time is to interpolate from a pre-calculated reaction rates table. The rates are specified when the reactions <code class="docutils literal notranslate"><span class="pre">rxn</span></code> are first created with the <code class="docutils literal notranslate"><span class="pre">&#64;reaction</span></code> decorator. They can be evaluated handily with <code class="docutils literal notranslate"><span class="pre">rxn.coeff_fn(chemicalnetwork)</span></code>. The range of temperature of interest for example <span class="math notranslate nohighlight">\(T = \rm (1, 10^8) K\)</span> can be first specified with <code class="docutils literal notranslate"><span class="pre">ChemicalNetwork.init_temperature(T_bounds=(1e0,</span> <span class="pre">1e8),</span> <span class="pre">n_bins=1024)</span></code>. The added reaction objects can be accessed with <code class="docutils literal notranslate"><span class="pre">ChemicalNetwork.reactions</span></code>. For example, the reaction rates of <code class="docutils literal notranslate"><span class="pre">k01</span></code> can the accessed with the snippet below</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rxn_rate</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="s1">&#39;k01&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coeff_fn</span><span class="p">(</span><span class="n">ChemicalNetwork</span><span class="p">)</span>
</pre></div>
</div>
<p>The output <code class="docutils literal notranslate"><span class="pre">rxn_rate</span></code> is an numpy array with a length of <code class="docutils literal notranslate"><span class="pre">[n_bins]</span></code>.</p>
<p>A reaction rate table is generated and exported to a <code class="docutils literal notranslate"><span class="pre">hdf5</span></code> file below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">ofn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">&lt;</span><span class="n">KeysViewHDF5</span> <span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;k01&#39;</span><span class="p">,</span> <span class="s1">&#39;k02&#39;</span><span class="p">,</span> <span class="s1">&#39;reHII_reHII&#39;</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="n">solver_name</span> <span class="o">=</span> <span class="s1">&#39;simple&#39;</span>
<span class="n">output_dir</span>  <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

<span class="n">ofn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s2">_tables.h5&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ofn</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rm </span><span class="si">{</span><span class="n">ofn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">ofn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">simpleNetwork</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">rxn</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">coeff_fn</span><span class="p">(</span><span class="n">simpleNetwork</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">simpleNetwork</span><span class="o">.</span><span class="n">cooling_actions</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rxn</span><span class="p">,</span> <span class="s2">&quot;tables&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tab</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">rxn</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">tab</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">tab</span><span class="p">](</span><span class="n">simpleNetwork</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">),</span>
                <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/T&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">simpleNetwork</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="using-jinja2">
<h2>Using <code class="docutils literal notranslate"><span class="pre">Jinja2</span></code><a class="headerlink" href="#using-jinja2" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Jinja2</span></code> fills out variables dynamically with the user-given inputs. It is however not limited to variables subsitution. You can also use conditions (if/else), for loops (for), filter, and tests in Jinja2 template. To construct our solver template for <code class="docutils literal notranslate"><span class="pre">scipy</span></code>, we will be using for-loop, if-else, and variable substitution. And we will go through these usages briefly below their respective syntax. We refer our readers for more details in <a class="reference external" href="http://jinja.octoprint.org/">Jinja2 Documentation</a>.</p>
<p>For example if the template is <code class="docutils literal notranslate"><span class="pre">Dengo</span> <span class="pre">{{token}}</span></code>, Jinja2 would look for the user-fed input for the variable <code class="docutils literal notranslate"><span class="pre">token</span></code>, and output the file with the word in curly bracket replaced with the <code class="docutils literal notranslate"><span class="pre">token</span> <span class="pre">=</span> <span class="pre">&quot;works&quot;</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;Dengo {{ token }}!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s2">&quot;works&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dengo works!
</pre></div>
</div>
</div>
</div>
<p>Jinja2 also provided an straightforward way to iterate over iterables like lists, with the syntax <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">item</span> <span class="pre">in</span> <span class="pre">list</span> <span class="pre">%}</span> <span class="pre">{%</span> <span class="pre">endfor</span> <span class="pre">%}</span></code>. In the example below, we iterate over the required species in our chemical network, and had Jinja2 print out their name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort %}</span>
<span class="s2">{{s.name}},</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">network</span> <span class="o">=</span> <span class="n">simpleNetwork</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>H_1,

H_2,

de,

ge,
</pre></div>
</div>
</div>
</div>
<section id="preparing-the-rates-interpolation-template">
<h3>Preparing the rates interpolation template<a class="headerlink" href="#preparing-the-rates-interpolation-template" title="Permalink to this heading">#</a></h3>
<p>In the template below, we demonstrate a simple implementation for interpolating reaction and cooling rates with <code class="docutils literal notranslate"><span class="pre">Jinja2</span></code> and our <code class="docutils literal notranslate"><span class="pre">ChemicalNetwork</span></code> object. In brief, the template below first reads in the rates from the <code class="docutils literal notranslate"><span class="pre">hdf5</span></code> we created above, and two functions <code class="docutils literal notranslate"><span class="pre">interpolate_rates</span></code> and <code class="docutils literal notranslate"><span class="pre">interpolate_cooling_rates</span></code> are created dynamically based on the reactions avaiable in our <code class="docutils literal notranslate"><span class="pre">ChemicalNetwork</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reaction_rates_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import numpy as np</span>
<span class="s2">import h5py</span>

<span class="s2"># read rates in as global variables</span>
<span class="s2">rates_table = &quot;{{solver_name}}_tables.h5&quot;</span>
<span class="s2">ratef = h5py.File(rates_table, &#39;r&#39;)</span>

<span class="s2"># Reaction Rates</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or k in network.reactions.keys()%}</span>
<span class="s2">out{{k}}dev = ratef[&#39;{{k}}&#39;][:]</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %} </span>

<span class="s2"># Cooling Rates</span>
<span class="s2">{</span><span class="si">%- f</span><span class="s2">or name, rate in network.cooling_actions | dictsort %}</span>
<span class="s2">{</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort %}</span>
<span class="s2">out_{{name}}_{{name2}} = ratef[&quot;{{name}}_{{name2}}&quot;][:]</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">tdev = ratef[&#39;T&#39;][:]</span>
<span class="s2">ratef.close()</span>

<span class="s2">def interpolate_rates(T):</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or k in network.reactions.keys()%}</span>
<span class="s2">    {{k}} = np.interp(T, tdev, out{{k}}dev)</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %} </span>
<span class="s2">    return (</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or k in network.reactions.keys() -%}</span>
<span class="s2">    {{k}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    )</span>
<span class="s2">def interpolate_cooling_rates(T):</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name, rate in network.cooling_actions | dictsort %}</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort %}</span>
<span class="s2">    {{name}}_{{name2}} = np.interp(T, tdev, out_{{name}}_{{name2}})</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">    return (</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name, rate in network.cooling_actions | dictsort -%}</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort -%}</span>
<span class="s2">    {{name}}_{{name2}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    )</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">template_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">network</span><span class="o">=</span><span class="n">simpleNetwork</span><span class="p">,</span> 
    <span class="n">solver_name</span><span class="o">=</span><span class="n">solver_name</span>
<span class="p">)</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s1">_reaction_rate.py&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">reaction_rates_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">template_vars</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-the-rendered-simple-reaction-rate-py-and-check-if-it-works">
<h3>Import the Rendered <code class="docutils literal notranslate"><span class="pre">simple_reaction_rate.py</span></code> and Check if it works!<a class="headerlink" href="#import-the-rendered-simple-reaction-rate-py-and-check-if-it-works" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">simple_reaction_rate</span> <span class="kn">import</span> <span class="n">interpolate_rates</span><span class="p">,</span> <span class="n">interpolate_cooling_rates</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">simpleNetwork</span><span class="o">.</span><span class="n">T</span>
<span class="n">rxnk01_rate</span><span class="p">,</span> <span class="n">rxnk02_rate</span> <span class="o">=</span> <span class="n">interpolate_rates</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
<span class="n">coolreHII_rate</span><span class="p">,</span>          <span class="o">=</span> <span class="n">interpolate_cooling_rates</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">rxnk01_rate</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;k01&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">rxnk02_rate</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;k02&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Temperature $(\rm K)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Reaction Rate $(\rm g^{-1} cm^</span><span class="si">{3}</span><span class="s1"> s^{-1} )$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">coolreHII_rate</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;reHII&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Cooling Rate reHII&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f0aeb391d00&gt;
</pre></div>
</div>
<img alt="../_images/e5a4ed177be279a38e1b41aead93801e9881de624ee50926e93d9bc6661d452d.png" src="../_images/e5a4ed177be279a38e1b41aead93801e9881de624ee50926e93d9bc6661d452d.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="implement-the-temperature-function">
<h1>Implement the temperature function<a class="headerlink" href="#implement-the-temperature-function" title="Permalink to this heading">#</a></h1>
<div class="highlight-jinja2 notranslate"><div class="highlight"><pre><span></span>gamma = 5./3.
kb    = 1.38e-16
mh    = 1.67e-24

def calculate_temperature(state: npt.ArrayLike):
    # extract the abundance from the state vector
    {% for s in network.required_species | sort -%}
    {{s.name}}, 
    {%- endfor -%}
    = state
    density = {{network.print_mass_density()}}
    T = {{network.temperature_calculation()}}
    return T
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temperature_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import numpy as np</span>
<span class="s2">gamma = 5./3.</span>
<span class="s2">kb    = 1.38e-16</span>
<span class="s2">mh    = 1.67e-24</span>

<span class="s2">def calculate_temperature(state):</span>
<span class="s2">    # extract the abundance from the state vector</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort -%}</span>
<span class="s2">    {{s.name}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = state</span>
<span class="s2">    density = {{network.print_mass_density()}}</span>
<span class="s2">    T = {{network.temperature_calculation()}}</span>
<span class="s2">    return T</span>
<span class="s2">    </span>

<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s1">_temperature.py&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temperature_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">network</span> <span class="o">=</span><span class="n">simpleNetwork</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load simple_temperature.py</span>

<span class="n">gamma</span> <span class="o">=</span> <span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">kb</span>    <span class="o">=</span> <span class="mf">1.38e-16</span>
<span class="n">mh</span>    <span class="o">=</span> <span class="mf">1.67e-24</span>

<span class="k">def</span> <span class="nf">calculate_temperature</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="c1"># extract the abundance from the state vector</span>
    <span class="n">H_1</span><span class="p">,</span><span class="n">H_2</span><span class="p">,</span><span class="n">de</span><span class="p">,</span><span class="n">ge</span><span class="p">,</span><span class="o">=</span> <span class="n">state</span>
    <span class="n">density</span> <span class="o">=</span> <span class="mf">1.0079400000000001</span><span class="o">*</span><span class="n">H_1</span> <span class="o">+</span> <span class="mf">1.0079400000000001</span><span class="o">*</span><span class="n">H_2</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">density</span><span class="o">*</span><span class="n">ge</span><span class="o">*</span><span class="n">mh</span><span class="o">/</span><span class="p">(</span><span class="n">kb</span><span class="o">*</span><span class="p">(</span><span class="n">H_1</span><span class="o">/</span><span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">H_2</span><span class="o">/</span><span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">de</span><span class="o">/</span><span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">T</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from simple_temperature import calculate_temperature</span>
<span class="kn">import</span> <span class="nn">numpy</span>  <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Prepare the initial state vector</span>
<span class="n">ge</span> <span class="o">=</span> <span class="mf">1e13</span>  <span class="c1">#erg/g</span>
<span class="n">H_1</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="c1"># 1/cm^3</span>
<span class="n">H_2</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="c1"># 1/cm^3</span>
<span class="n">de</span>  <span class="o">=</span> <span class="mf">1e-2</span><span class="c1"># 1/cm^3</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">H_1</span><span class="p">,</span> <span class="n">H_2</span><span class="p">,</span> <span class="n">de</span><span class="p">,</span> <span class="n">ge</span><span class="p">])</span>
<span class="n">simple_temperature</span><span class="o">.</span><span class="n">calculate_temperature</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>54211.26570048309
</pre></div>
</div>
</div>
</div>
<section id="implement-the-rhs-function">
<h2>Implement the RHS function<a class="headerlink" href="#implement-the-rhs-function" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rhs_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import numpy as np</span>
<span class="s2">from {{solver_name}}_temperature import calculate_temperature</span>
<span class="s2">from {{solver_name}}_reaction_rate import interpolate_rates, interpolate_cooling_rates</span>
<span class="s2">mh    = 1.67e-24</span>

<span class="s2">def rhs_func(state, t):</span>

<span class="s2">    # extract the abundance from the state vector</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort -%}</span>
<span class="s2">    {{s.name}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = state</span>
<span class="s2">    </span>
<span class="s2">    T   = calculate_temperature(state)[np.newaxis]</span>
<span class="s2">    </span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or k in network.reactions.keys() -%}</span>
<span class="s2">    {{k}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = interpolate_rates    (T)</span>
<span class="s2">    </span>
<span class="s2">    i = 0</span>
<span class="s2">    </span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or name, rate in network.cooling_actions | dictsort -%}</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort -%}</span>
<span class="s2">    {{name}}_{{name2}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = interpolate_cooling_rates(T)</span>
<span class="s2">    </span>
<span class="s2">    rho = {{network.print_mass_density()}}</span>
<span class="s2">    </span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort %}</span>
<span class="s2">    {</span><span class="si">% i</span><span class="s2">f s.name != &quot;ge&quot; %}</span>
<span class="s2">    d{{s.name}}dt = {{network.species_total(s)}}</span>
<span class="s2">    {</span><span class="si">% e</span><span class="s2">lse %}</span>
<span class="s2">    d{{s.name}}dt = {{network.print_cooling(assign_to=None)}} / mh/ rho</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndif -%}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">    </span>
<span class="s2">    return {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort -%}</span>
<span class="s2">    d{{s.name}}dt, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>

<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s1">_rhs.py&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rhs_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">template_vars</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">simple_rhs</span> <span class="kn">import</span> <span class="n">rhs_func</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>

<span class="n">timesteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>
<span class="n">output</span>     <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">rhs_func</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">timesteps</span><span class="p">)</span>

<span class="n">H_1_traj</span><span class="p">,</span> <span class="n">H_2_traj</span><span class="p">,</span> <span class="n">de_traj</span><span class="p">,</span> <span class="n">ge_traj</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">T</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">l1</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">H_1_traj</span><span class="p">)</span>
<span class="n">l2</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">H_2_traj</span><span class="p">)</span>
<span class="n">l3</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">de_traj</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">T_traj</span> <span class="o">=</span> <span class="n">calculate_temperature</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">l4</span><span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">T_traj</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Abundance ($\rm cm^{-3}$)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">l3</span><span class="p">,</span><span class="n">l4</span><span class="p">],</span> 
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\rm H$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\rm H^+$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\rm e^-$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\rm T$&#39;</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">[</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.4</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6081/297263008.py:23: UserWarning: You have mixed positional and keyword arguments, some input may be discarded.
  f.legend(
</pre></div>
</div>
<img alt="../_images/9bac4aa903dc534a11e7e5cafacf79ec2bd0aa1fdd2498bb580a170e88d23dce.png" src="../_images/9bac4aa903dc534a11e7e5cafacf79ec2bd0aa1fdd2498bb580a170e88d23dce.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver_rhs_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import h5py</span>
<span class="s2">import numpy as np</span>
<span class="s2">gamma = 5./3.</span>
<span class="s2">kb    = 1.38e-16</span>
<span class="s2">mh    = 1.67e-24</span>


<span class="s2"># read rates in as global variables</span>
<span class="s2">rates_table = &quot;{{solver_name}}_tables.h5&quot;</span>
<span class="s2">ratef = h5py.File(rates_table, &#39;r&#39;)</span>

<span class="s2"># Reaction Rates</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or k in network.reactions.keys()%}</span>
<span class="s2">out{{k}}dev = ratef[&#39;{{k}}&#39;][:]</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %} </span>

<span class="s2"># Cooling Rates</span>
<span class="s2">{</span><span class="si">%- f</span><span class="s2">or name, rate in network.cooling_actions | dictsort %}</span>
<span class="s2">{</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort %}</span>
<span class="s2">out_{{name}}_{{name2}} = ratef[&quot;{{name}}_{{name2}}&quot;][:]</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">tdev = ratef[&#39;T&#39;][:]</span>
<span class="s2">ratef.close()</span>

<span class="s2">def interpolate_rates(T):</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or k in network.reactions.keys()%}</span>
<span class="s2">    {{k}} = np.interp(T, tdev, out{{k}}dev)</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %} </span>
<span class="s2">    return (</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or k in network.reactions.keys() -%}</span>
<span class="s2">    {{k}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    )</span>
<span class="s2">def interpolate_cooling_rates(T):</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name, rate in network.cooling_actions | dictsort %}</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort %}</span>
<span class="s2">    {{name}}_{{name2}} = np.interp(T, tdev, out_{{name}}_{{name2}})</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">    return (</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name, rate in network.cooling_actions | dictsort -%}</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort -%}</span>
<span class="s2">    {{name}}_{{name2}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    )</span>


<span class="s2">def calculate_temperature(state):</span>
<span class="s2">    # extract the abundance from the state vector</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort -%}</span>
<span class="s2">    {{s.name}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = state</span>
<span class="s2">    density = {{network.print_mass_density()}}</span>
<span class="s2">    T = {{network.temperature_calculation()}}</span>
<span class="s2">    return T</span>
<span class="s2">    </span>
<span class="s2">def rhs_func(state, t):</span>

<span class="s2">    # extract the abundance from the state vector</span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort -%}</span>
<span class="s2">    {{s.name}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = state</span>
<span class="s2">    </span>
<span class="s2">    T   = calculate_temperature(state)[np.newaxis]</span>
<span class="s2">    </span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or k in network.reactions.keys() -%}</span>
<span class="s2">    {{k}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = interpolate_rates    (T)</span>
<span class="s2">    </span>
<span class="s2">    i = 0</span>
<span class="s2">    </span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or name, rate in network.cooling_actions | dictsort -%}</span>
<span class="s2">    {</span><span class="si">%- f</span><span class="s2">or name2 in rate.tables | sort -%}</span>
<span class="s2">    {{name}}_{{name2}}, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">    = interpolate_cooling_rates(T)</span>
<span class="s2">    </span>
<span class="s2">    rho = {{network.print_mass_density()}}</span>
<span class="s2">    </span>
<span class="s2">    {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort %}</span>
<span class="s2">    {</span><span class="si">% i</span><span class="s2">f s.name != &quot;ge&quot; %}</span>
<span class="s2">    d{{s.name}}dt = {{network.species_total(s)}}</span>
<span class="s2">    {</span><span class="si">% e</span><span class="s2">lse %}</span>
<span class="s2">    d{{s.name}}dt = {{network.print_cooling(assign_to=None)}} / mh/ rho</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndif -%}</span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">    </span>
<span class="s2">    return {</span><span class="si">% f</span><span class="s2">or s in network.required_species | sort -%}</span>
<span class="s2">    d{{s.name}}dt, </span>
<span class="s2">    {</span><span class="si">%- e</span><span class="s2">ndfor -%}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s1">_solver.py&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">solver_rhs_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">template_vars</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">simple_solver</span> <span class="kn">import</span> <span class="n">rhs_func</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>
<span class="n">output</span>     <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">rhs_func</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">timesteps</span><span class="p">)</span>

<span class="n">H_1_traj</span><span class="p">,</span> <span class="n">H_2_traj</span><span class="p">,</span> <span class="n">de_traj</span><span class="p">,</span> <span class="n">ge_traj</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">T</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">l1</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">H_1_traj</span><span class="p">)</span>
<span class="n">l2</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">H_2_traj</span><span class="p">)</span>
<span class="n">l3</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">de_traj</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">T_traj</span> <span class="o">=</span> <span class="n">calculate_temperature</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">l4</span><span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">T_traj</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Abundance ($\rm cm^{-3}$)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">l3</span><span class="p">,</span><span class="n">l4</span><span class="p">],</span> 
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\rm H$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\rm H^+$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\rm e^-$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\rm T$&#39;</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">[</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.4</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_6081/2565928376.py:20: UserWarning: You have mixed positional and keyword arguments, some input may be discarded.
  f.legend(
</pre></div>
</div>
<img alt="../_images/9bac4aa903dc534a11e7e5cafacf79ec2bd0aa1fdd2498bb580a170e88d23dce.png" src="../_images/9bac4aa903dc534a11e7e5cafacf79ec2bd0aa1fdd2498bb580a170e88d23dce.png" />
</div>
</div>
</section>
<section id="yay-you-have-learnt-how-to-write-a-jinja2-template-from-scratch">
<h2>Yay! you have learnt how to write a Jinja2 template from scratch<a class="headerlink" href="#yay-you-have-learnt-how-to-write-a-jinja2-template-from-scratch" title="Permalink to this heading">#</a></h2>
<p>this template is also available under <code class="docutils literal notranslate"><span class="pre">dengo/templates/scipy/dengo_rhs.py.template</span></code>. While we only demonstrated it with a 2 species model with 2 reactions and 1 cooling action. This would still work for any user-specied network!</p>
<p>The workflow we outlined in this chapter works for a simple prototyping with <code class="docutils literal notranslate"><span class="pre">scipy.integrate.odeint</span></code>. To extend it to more efficient deployments with <code class="docutils literal notranslate"><span class="pre">C</span></code> libraries and the ODE solver <code class="docutils literal notranslate"><span class="pre">SUNDIALS</span> <span class="pre">CVODE</span></code> in massively parallel setting, we have also provide our template function for generating compilable C-libraries under <code class="docutils literal notranslate"><span class="pre">dengo/templates/</span></code>. This will be introduced in the next chapter.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./tutorial"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How Does Dengo Generate Solvers?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries-and-create-the-network">Import Libraries and Create the Network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-solver">Building the solver</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-the-reaction-rates">Evaluate the reaction rates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-jinja2">Using <code class="docutils literal notranslate"><span class="pre">Jinja2</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-rates-interpolation-template">Preparing the rates interpolation template</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-the-rendered-simple-reaction-rate-py-and-check-if-it-works">Import the Rendered <code class="docutils literal notranslate"><span class="pre">simple_reaction_rate.py</span></code> and Check if it works!</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-temperature-function">Implement the temperature function</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-rhs-function">Implement the RHS function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#yay-you-have-learnt-how-to-write-a-jinja2-template-from-scratch">Yay! you have learnt how to write a Jinja2 template from scratch</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sunny Tang
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>